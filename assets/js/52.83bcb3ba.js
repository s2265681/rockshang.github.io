(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{450:function(e,t,s){"use strict";s.r(t);var a=s(44),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"koa实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#koa实战"}},[e._v("#")]),e._v(" koa实战")]),e._v(" "),s("ul",[s("li",[e._v("koa 引入")]),e._v(" "),s("li",[e._v("模版引擎（落后 前端可以解决）")]),e._v(" "),s("li",[e._v("鉴权 授权 session/cookie 、 Token 、 OAuth")]),e._v(" "),s("li",[e._v("Restful API 及常见")])]),e._v(" "),s("ol",[s("li",[s("p",[e._v("概念：新的 web 框架 更小更健硕 express 下一代基于 Node.js 的框架")])]),e._v(" "),s("li",[s("p",[e._v("特点")]),e._v(" "),s("ul",[s("li",[e._v("轻量")]),e._v(" "),s("li",[e._v("中间件架构")]),e._v(" "),s("li",[e._v("优雅的 API 设计")]),e._v(" "),s("li",[e._v("增强的错误处理 async 语法增强")])])]),e._v(" "),s("li",[s("p",[e._v("安装")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("  npm i koa -S\n")])])])]),e._v(" "),s("li",[s("p",[e._v("中间件机制、请求、响应\n-> mid.js\nnext()\n洋葱模型\nOOP 面向对象的编程\nAOP 面向切面的编程 语言级 框架级\n顺序执行、也有横向的需要 切面层面，如 鉴权 错误处理 日志 ---\x3e 中间件的使用情况")])]),e._v(" "),s("li",[s("p",[e._v("上下环境的总结 ctx")]),e._v(" "),s("ul",[s("li",[e._v(".req Node 的 request")]),e._v(" "),s("li",[e._v(".res Node 的 response")]),e._v(" "),s("li",[e._v(".response koa 的 response")]),e._v(" "),s("li",[e._v(".request koa 的 request")]),e._v(" "),s("li",[e._v(".state 推荐命名空间 用于中间件传递信息和前端视图")]),e._v(" "),s("li",[e._v(".app 应用程序引用")])])]),e._v(" "),s("li",[s("p",[e._v("router - npm i koa-router -S\n-> router-Pro 使用路由")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("     // 编写\n     const Router = require('koa-router')\n     const router  = new Router({prefix:'/users'})\n\n     router.get('/',ctx=>{\n         ctx.body = 'user'\n     })\n\n     module.exports = router\n     // 使用\n     const users = require('./routes/users')\n     app.use(index.routes())\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[s("p",[e._v("静态文件服务 模版引擎")]),e._v(" "),s("ul",[s("li",[e._v("npm i koa-static -S")])]),e._v(" "),s("p",[e._v("-> router-Pro/public/test.html")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    // index.js 引入\n    const static = require('koa-static')\n    app.use(static(__dirname + '/public'))\n    // 编写\n    router-Pro/public\n    // 执行\n    // http://localhost:3001/login-session.html\n")])])]),s("ul",[s("li",[e._v("Handlebars templates for Koa\n"),e._v("\nhttps://github.com/koajs/koa-hbs")]),e._v(" "),s("li",[e._v("npm install koa-hbs@next --save\n-> router-Pro/views")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("   // app 中引入\n   const hbs = require('koa-hbs')\n   app.use(hbs.middleware({\n      viewPath:__dirname + '/views, // 视图根目录\n      defaultLayout:'layout', // 默认的布局页面\n      partialsPath:__dirname + '/views/partials', // 注册partial目录\n      disableCache:true  // 开发不缓存\n  }))\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("  // 使用\n  // ->routes/index.js\n\n")])])]),s("ul",[s("li",[s("p",[e._v("使用 moment 方法\nconst helpers = require('./utils/ helpers')")])]),e._v(" "),s("li",[s("p",[e._v("常用的工厂方法\nhttps://github.com/helpers/handlebars-helpers")])]),e._v(" "),s("li",[s("p",[e._v("高级应用: 代码搬家（类似于插槽 引入jquery）\n// -> layout.hbs")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("<script src=\"https://cdn.bootcss.com/   jquery/3.3.1/jquery.min.js\">\n<\/script>\n{{#block 'jquery'}}{{/block}}\n")])])]),s("p",[e._v("// 在 users.hbs 里面使用 jquery , 控制台就会打印出 content for jQuery")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("  {{#contentFor 'jquery'}}\n  <script>\n      $(function(){\n          console.log('content for jQuery')\n      })\n  <\/script>\n  {{/contentFor}}\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("cookie是否显示视频")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v(" // 若cookie中不存在记录则不在播放，index.js\n   let showVideo;\n if(ctx.cookies.get('isPlayed')) {\n   showVideo = false;\n }else{\n     showVideo = true;\n     ctx.cookies.set('isPlayed',true,{**maxAge**:7 * 24 * 3600000});\n }\n await ctx.render('index',{list,showVideo})\n")])])]),s("p",[e._v("// 隐藏视频，index.hbs")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('  {{#contentFor \'jquery\'}}\n    < script >\n        $("#home-banner-video").on("ended",function(){\n          $(this).remove();\n        })\n    < /script > \n    {{/contentFor}}\n')])])]),s("ol",{attrs:{start:"9"}},[s("li",[e._v("列表排序")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("```\nconst list  = ctx.state.vipCoures\nlist.sort((a,b)=>a.sort-b.sort)\nawait ctx.render('index',{list})\n```\n")])])]),s("ol",{attrs:{start:"10"}},[s("li",[s("p",[e._v("ctx")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("ctx.accepts('html') === 'html'  判断是不是渲染html页面")])]),e._v(" "),s("li",[s("p",[e._v("ctx.state.dataValue = 存取data数据")])]),e._v(" "),s("li",[s("p",[e._v("ctx.cookie.set('isPlayed',true,{maxAge:7 * 24 * 3600000,httpOnly:false})")])]),e._v(" "),s("li",[s("p",[e._v("ctx.cookie.get('isPlayed)")])]),e._v(" "),s("li",[s("p",[e._v("ctx.render('index',{list})   // 渲染模版引擎 传入list数据")])]),e._v(" "),s("li",[s("p",[e._v("ctx.body = 'hello world'    //  == res.")])]),e._v(" "),s("li",[s("p",[e._v("ctx.res.statusCode = 404;   // 状态码")])]),e._v(" "),s("li",[s("p",[e._v("ctx.request.body            // 获取body数据")])]),e._v(" "),s("li",[s("p",[e._v("ctx.res")])])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);